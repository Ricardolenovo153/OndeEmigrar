<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quero Emigrar - Portal Profissional</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>

    <div id="toast-container"></div>

    <div class="container">
        <header>
            <h1 class="logo">quero<span>emigrar</span></h1>
            <p class="tagline">Análise algorítmica para o teu futuro internacional</p>
        </header>

        <main id="home-page" class="card">
            <div class="top-row">
                <div class="input-group">
                    <label>Origem</label>
                    <select class="custom-select">
                        <option>Portugal</option>
                        <option>Brasil</option>
                    </select>
                </div>
                <button class="btn-perfil" id="btn-count-perfil" onclick="togglePages('profiles-page')">Meus Perfis (0)</button>
            </div>

            <h2 class="section-title">Define as tuas Prioridades</h2>

            <div class="sliders-grid">
                <div class="slider-box">
                    <div class="slider-info"><span>Economia / PIB</span><span class="percentage" id="val-0">20%</span></div>
                    <input type="range" class="range-slider" id="slider-0" min="0" max="100" value="20" oninput="updateSliderUI(0, this.value)">
                </div>
                <div class="slider-box">
                    <div class="slider-info"><span>Saúde e Qualidade</span><span class="percentage" id="val-1">20%</span></div>
                    <input type="range" class="range-slider" id="slider-1" min="0" max="100" value="20" oninput="updateSliderUI(1, this.value)">
                </div>
                <div class="slider-box">
                    <div class="slider-info"><span>Educação e Investigação</span><span class="percentage" id="val-2">20%</span></div>
                    <input type="range" class="range-slider" id="slider-2" min="0" max="100" value="20" oninput="updateSliderUI(2, this.value)">
                </div>
                <div class="slider-box">
                    <div class="slider-info"><span>Estabilidade Política</span><span class="percentage" id="val-3">15%</span></div>
                    <input type="range" class="range-slider" id="slider-3" min="0" max="100" value="15" oninput="updateSliderUI(3, this.value)">
                </div>
                <div class="slider-box">
                    <div class="slider-info"><span>Estado de Direito</span><span class="percentage" id="val-4">15%</span></div>
                    <input type="range" class="range-slider" id="slider-4" min="0" max="100" value="15" oninput="updateSliderUI(4, this.value)">
                </div>
                <div class="slider-box">
                    <div class="slider-info"><span>Baixa Emigração</span><span class="percentage" id="val-5">10%</span></div>
                    <input type="range" class="range-slider" id="slider-5" min="0" max="100" value="10" oninput="updateSliderUI(5, this.value)">
                </div>
            </div>

            <div class="actions-group">
                <button class="btn-perfil btn-save" onclick="saveCurrentProfile()">SALVAR NA PREDEFINIÇÃO</button>
                <button class="btn-main" onclick="calculateRanking()">VER OS MEUS MELHORES DESTINOS</button>
            </div>
        </main>

        <main id="profiles-page" class="card hidden">
            <div class="menu-header">
                <button class="btn-back" onclick="togglePages('home-page')">← Voltar</button>
                <h2 class="menu-title-text">Gestão de Perfis</h2>
            </div>
            <div class="profiles-grid" id="profiles-container"></div>
        </main>

        <main id="results-page" class="card hidden">
            <div class="menu-header">
                <button class="btn-back" onclick="togglePages('home-page')">← Reajustar</button>
                <h2 class="menu-title-text">Ranking de Destinos</h2>
            </div>
            <div id="ranking-list" class="ranking-container"></div>
        </main>
    </div>

    <script>
        const countriesData = [
            { name: "Suíça", scores: [98, 92, 85, 99, 97, 95] },
            { name: "Dinamarca", scores: [85, 96, 90, 98, 99, 90] },
            { name: "Noruega", scores: [92, 98, 88, 97, 95, 92] },
            { name: "Holanda", scores: [90, 88, 94, 92, 93, 85] }
        ];

        let profiles = JSON.parse(localStorage.getItem('emigrar_v4')) || [
            { id: 1, name: 'Perfil Padrão', active: true, values: [20, 20, 20, 15, 15, 10] }
        ];

        const labels = ["ECO", "SAÚ", "EDU", "POL", "DIR", "RET"];

        function togglePages(pageId) {
            document.querySelectorAll('main').forEach(m => m.classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
            if(pageId === 'home-page') loadActiveProfileValues();
            renderProfiles();
        }

        function updateSliderUI(index, val) {
            document.getElementById(`val-${index}`).innerText = val + '%';
        }

        function saveCurrentProfile() {
            let activeIdx = profiles.findIndex(p => p.active);
            if (activeIdx !== -1) {
                const newValues = [];
                for(let i=0; i<6; i++) {
                    newValues.push(parseInt(document.getElementById(`slider-${i}`).value));
                }
                profiles[activeIdx].values = newValues;
                localStorage.setItem('emigrar_v4', JSON.stringify(profiles));
                showToast(`Sucesso! "${profiles[activeIdx].name}" atualizado.`);
                renderProfiles();
            }
        }

        function loadActiveProfileValues() {
            const active = profiles.find(p => p.active);
            if (active) {
                active.values.forEach((val, i) => {
                    const slider = document.getElementById(`slider-${i}`);
                    if(slider) {
                        slider.value = val;
                        document.getElementById(`val-${i}`).innerText = val + '%';
                    }
                });
            }
        }

        function renderProfiles() {
            const container = document.getElementById('profiles-container');
            document.getElementById('btn-count-perfil').innerText = `Meus Perfis (${profiles.length})`;
            
            container.innerHTML = `<div class="profile-card add-new" onclick="createProfile()"><div class="add-circle">+</div><p>Novo Perfil</p></div>`;

            profiles.forEach(p => {
                const div = document.createElement('div');
                div.className = `profile-card ${p.active ? 'active' : ''}`;
                div.onclick = () => { setActive(p.id); togglePages('home-page'); };
                
                const previewHtml = p.values.map((v, i) => `
                    <div class="bar-wrapper">
                        <div class="preview-bar" style="height: ${v}%"></div>
                        <span class="bar-label">${labels[i]}</span>
                    </div>
                `).join('');

                div.innerHTML = `
                    <div class="profile-header"><span class="p-name">${p.name}</span><button class="btn-del" onclick="confirmDelete(${p.id}, event)">×</button></div>
                    <div class="bars-container">${previewHtml}</div>
                `;
                container.prepend(div);
            });
        }

        function confirmDelete(id, e) {
            e.stopPropagation();
            if (confirm(`Eliminar este perfil?`)) deleteProfile(id);
        }

        function deleteProfile(id) {
            if(profiles.length > 1) {
                profiles = profiles.filter(p => p.id !== id);
                if(!profiles.find(p => p.active)) profiles[0].active = true;
                saveAndRender();
                showToast("Perfil removido.");
            } else {
                showToast("Erro: Mantém pelo menos um perfil.");
            }
        }

        function calculateRanking() {
            const weights = Array.from({length: 6}, (_, i) => parseInt(document.getElementById(`slider-${i}`).value));
            const ranked = countriesData.map(c => {
                let finalScore = c.scores.reduce((acc, s, i) => acc + (s * (weights[i] / 100)), 0);
                return { name: c.name, score: finalScore.toFixed(1) };
            }).sort((a, b) => b.score - a.score);

            document.getElementById('ranking-list').innerHTML = ranked.map((c, i) => `
                <div class="ranking-item"><span class="rank-pos">#${i+1}</span><span class="rank-name">${c.name}</span><span class="rank-score">${c.score} pts</span></div>
            `).join('');
            togglePages('results-page');
        }

        function createProfile() {
            const name = prompt("Nome do novo perfil:");
            if (name) {
                profiles.forEach(p => p.active = false);
                profiles.push({ id: Date.now(), name, active: true, values: [20, 20, 20, 15, 15, 10] });
                saveAndRender();
                togglePages('home-page');
            }
        }

        function setActive(id) { profiles.forEach(p => p.active = (p.id === id)); saveAndRender(); }
        function saveAndRender() { localStorage.setItem('emigrar_v4', JSON.stringify(profiles)); renderProfiles(); }
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            toast.innerText = message;
            document.getElementById('toast-container').appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 500); }, 3000);
        }

        window.onload = () => { loadActiveProfileValues(); renderProfiles(); };
    </script>
</body>
</html>